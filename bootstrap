#!/usr/bin/env bash
# bootstrap.sh
set -euo pipefail

ROOT="$(dirname $(realpath $BASH_SOURCE))"
STAGES_DIR="$ROOT/bootstrap.d"
DEV_DIR="$HOME/dev/home/github.com/arubertoson/zsh"

log() { printf "\033[1;36m[BOOT]\033[0m %s\n" "$*"; }

log "Running apt update / upgrade"
sudo apt update -y && sudo apt upgrade -y

# Run all executable files with NN-* names in order
for stage in "$STAGES_DIR"/[0-9][0-9]-*; do
  [ -x "$stage" ] || continue
  log "Running $(basename "$stage")"
  "$stage"
done

log "linking $ROOT to $DEV_DIR"
ln -sfn -- $ROOT $DEV_DIR

log "All stages complete."
